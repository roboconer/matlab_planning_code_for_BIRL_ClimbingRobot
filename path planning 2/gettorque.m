function [Torque1,Torque2,Torque3,Torque4,Torque5]=gettorque(a,aa,aaa)
m=[3150 1800 4700 2900 1800 3150 0];
g=9800;
Z=[0;0;1];
L1=280;L2=106;L3=375; 
Lc2=33.7;Lc3=188;Lc4=261.3;Lc5=72.3;Lc6=132.7; 
P(:,:,2)=[0;0;(-L1)]; 
P(:,:,3)=[0;0;(-L2)];
P(:,:,4)=[(-L3);0;0]; 
P(:,:,5)=[(-L3);0;0];
P(:,:,6)=[0;(-L2);0];
P(:,:,7)=[0;0;L1];
Pc(:,:,2)=[0;0;(-Lc2)];
Pc(:,:,3)=[(-Lc3);0;0];
Pc(:,:,4)=[(-Lc4);0;0];
Pc(:,:,5)=[0;(-Lc5);0];
Pc(:,:,6)=[0;0;Lc6];
Pc(:,:,7)=[0;0;0];
W(:,:,1)=[0;0;0]; Wa(:,:,1)=[0;0;0];
V(:,:,1)=[0;0;0];Va(:,:,1)=[g;0;0];Vac(:,:,1)=[0;0;0];
f(:,:,7)=[0;0;0];n(:,:,7)=[0;0;0];
Ix2=4.2.*10.^6;Iy2=4.2.*10.^6;Iz2=1.7.*10.^6;
Ix3=3.4.*10.^6;Iy3=2.9.*10.^7;Iz3=2.9.*10.^7;
Ix4=4.2.*10.^6;Iy4=7.4.*10.^7;Iz4=7.4.*10.^7;
Ix5=1.7.*10.^6;Iy5=4.2.*10.^6;Iz5=4.2.*10.^6;
Ix6=1.9.*10.^7;Iy6=1.7.*10.^7;Iz6=5.0.*10.^6;
I(:,:,2)=[Ix2 0 0;0 Iy2 0;0 0 Iz2];          %惯性矩
I(:,:,3)=[Ix3 0 0;0 Iy3 0;0 0 Iz3];
I(:,:,4)=[Ix4 0 0;0 Iy4 0;0 0 Iz4];
I(:,:,5)=[Ix5 0 0;0 Iy5 0;0 0 Iz5];
I(:,:,6)=[Ix6 0 0;0 Iy6 0;0 0 Iz6];
I(:,:,7)=[0 0 0;0 0 0;0 0 0];
invR(:,:,6)=[1 0 0; 0 1 0; 0 0 1];
invR(:,:,1)=[cos(a(2)) -sin(a(2)) 0; sin(a(2)) cos(a(2)) 0; 0 0 1];            %求各个关节的旋转坐标系的逆阵
invR(:,:,2)=[cos(a(3)) -sin(a(3)) 0; 0 0 1; -sin(a(3)) -cos(a(3)) 0];
invR(:,:,3)=[cos(a(4)) -sin(a(4)) 0; sin(a(4)) cos(a(4)) 0; 0 0 1];
invR(:,:,4)=[cos(a(5)) -sin(a(5)) 0; sin(a(5)) cos(a(5)) 0; 0 0 1];
invR(:,:,5)=[cos(a(6)) -sin(a(6)) 0; 0 0 -1; sin(a(6)) cos(a(6)) 0];
R(:,:,1)=inv([cos(a(2)) -sin(a(2)) 0; sin(a(2)) cos(a(2)) 0; 0 0 1]);          %求各个关节的旋转坐标系
R(:,:,2)=inv([cos(a(3)) -sin(a(3)) 0; 0 0 1; -sin(a(3)) -cos(a(3)) 0]);
R(:,:,3)=inv([cos(a(4)) -sin(a(4)) 0; sin(a(4)) cos(a(4)) 0; 0 0 1]);
R(:,:,4)=inv([cos(a(5)) -sin(a(5)) 0; sin(a(5)) cos(a(5)) 0; 0 0 1]);
R(:,:,5)=inv([cos(a(6)) -sin(a(6)) 0; 0 0 -1; sin(a(6)) cos(a(6)) 0]);
R(:,:,6)=[1 0 0; 0 1 0; 0 0 1];
for i=1:6
    W(:,:,i+1)=R(:,:,i)*W(:,:,i)+aa(i+1)*Z;                                                     %求动力学参数，包括角速度，角加速度，速度，加速度，力和力矩
    Wa(:,:,i+1)=R(:,:,i)*Wa(:,:,i)+R(:,:,i)*cross(W(:,:,i),(aa(i+1)*Z))+aaa(i+1)*Z;
    Va(:,:,i+1)=R(:,:,i)*(cross(Wa(:,:,i),P(:,:,i+1))+cross(W(:,:,i),cross(W(:,:,i),P(:,:,i+1)))+Va(:,:,i));
    Vac(:,:,i+1)=cross(Wa(:,:,i+1),Pc(:,:,i+1))+cross(W(:,:,i+1),cross(W(:,:,i+1),Pc(:,:,i+1)))+Va(:,:,i+1);
    F(:,:,i+1)=m(i+1)*Vac(:,:,i+1);
    N(:,:,i+1)=I(:,:,i+1)*Wa(:,:,i+1)+cross(W(:,:,i+1),(I(:,:,i+1)*W(:,:,i+1)));
end
for j=6:(-1):2                                                                                   %求关节力矩
    f(:,:,j)=invR(:,:,j)*f(:,:,j+1)+F(:,:,j);
    n(:,:,j)=N(:,:,j)+invR(:,:,j)*n(:,:,j+1)+cross(Pc(:,:,j),F(:,:,j))+cross(P(:,:,j+1),(invR(:,:,j)*f(:,:,j+1)));
    tor(:,j)=n(:,:,j);
end
Torque1=tor(3,2);
Torque2=tor(3,3);
Torque3=tor(3,4);
Torque4=tor(3,5);
Torque5=tor(3,6);
end



